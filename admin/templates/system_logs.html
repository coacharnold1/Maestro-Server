<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Logs - Maestro Admin</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ecf0f1;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            color: #3498db;
        }

        .header p {
            color: #95a5a6;
        }

        .nav-links {
            margin-top: 15px;
        }

        .nav-links a {
            color: #3498db;
            text-decoration: none;
            padding: 8px 15px;
            margin: 0 5px;
            border: 1px solid #3498db;
            border-radius: 5px;
            display: inline-block;
            transition: all 0.3s;
            background: rgba(52, 152, 219, 0.1);
        }

        .nav-links a:hover {
            background: #3498db;
            color: white;
        }

        .content {
            padding: 0;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .log-type-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .log-type-tabs button {
            padding: 10px 20px;
            border: 1px solid #3498db;
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .log-type-tabs button.active {
            background: #3498db;
            color: white;
        }

        .log-type-tabs button:hover {
            background: #3498db;
            color: white;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            flex: 1;
            align-items: center;
        }

        .filter-controls input {
            flex: 1;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #ecf0f1;
            border-radius: 5px;
            font-size: 14px;
        }

        .filter-controls select {
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            color: #ecf0f1;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-refresh {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
        }

        .btn-refresh:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }

        .btn-clear {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-clear:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-download {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .auto-refresh-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            color: #ecf0f1;
        }

        .auto-refresh-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .log-container {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 600px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .log-line {
            padding: 2px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .log-line:hover {
            background: rgba(255,255,255,0.05);
        }

        .log-line.error {
            color: #fc8181;
            font-weight: 600;
        }

        .log-line.warning {
            color: #f6ad55;
        }

        .log-line.info {
            color: #63b3ed;
        }

        .log-line.debug {
            color: #9ae6b4;
        }

        .log-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .stat {
            flex: 1;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #3498db;
        }

        .stat-label {
            font-size: 12px;
            color: #95a5a6;
            text-transform: uppercase;
            margin-top: 5px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-logs {
            text-align: center;
            padding: 40px;
            color: #a0aec0;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-controls {
                flex-direction: column;
            }

            .log-type-tabs {
                width: 100%;
            }

            .log-type-tabs button {
                flex: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìã System Logs</h1>
            <p>Monitor and troubleshoot Maestro services</p>
            <div class="nav-links">
                <a href="/">‚Üê Admin Home</a>
                <a href="/library">Library Management</a>
                <a href="/audio">Audio Tweaks</a>
                <a href="/system">System Admin</a>
                <a href="javascript:window.location.href='http://' + window.location.hostname + ':5003'" style="background: rgba(52, 152, 219, 0.2); border-color: #3498db; color: #3498db;">üéµ Maestro Control</a>
            </div>
        </div>

        <div class="content">
            <div class="log-stats">
                <div class="stat">
                    <div class="stat-value" id="total-lines">0</div>
                    <div class="stat-label">Total Lines</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="error-count">0</div>
                    <div class="stat-label">Errors</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="warning-count">0</div>
                    <div class="stat-label">Warnings</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="last-update">Never</div>
                    <div class="stat-label">Last Update</div>
                </div>
            </div>

            <div class="controls">
                <div class="log-type-tabs">
                    <button class="active" data-log="mpd">MPD Logs</button>
                    <button data-log="maestro-web">Maestro Web</button>
                    <button data-log="maestro-admin">Maestro Admin</button>
                    <button data-log="system">System Logs</button>
                </div>

                <div class="filter-controls">
                    <input type="text" id="search-input" placeholder="Search logs...">
                    <select id="level-filter">
                        <option value="all">All Levels</option>
                        <option value="error">Errors Only</option>
                        <option value="warning">Warnings+</option>
                        <option value="info">Info+</option>
                    </select>
                </div>

                <div class="action-buttons">
                    <label class="auto-refresh-toggle">
                        <input type="checkbox" id="auto-refresh" checked>
                        <span>Auto-refresh (5s)</span>
                    </label>
                    <button class="btn btn-refresh" onclick="refreshLogs()">üîÑ Refresh</button>
                    <button class="btn btn-download" onclick="downloadLogs()">‚¨áÔ∏è Download</button>
                    <button class="btn btn-clear" onclick="clearDisplay()">üóëÔ∏è Clear</button>
                </div>
            </div>

            <div class="log-container" id="log-display">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading logs...
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentLogType = 'mpd';
        let autoRefreshInterval = null;
        let allLogs = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Log type tab switching
            document.querySelectorAll('.log-type-tabs button').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.log-type-tabs button').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentLogType = this.dataset.log;
                    refreshLogs();
                });
            });

            // Search filter
            document.getElementById('search-input').addEventListener('input', filterLogs);
            
            // Level filter
            document.getElementById('level-filter').addEventListener('change', filterLogs);

            // Auto-refresh toggle
            document.getElementById('auto-refresh').addEventListener('change', function() {
                if (this.checked) {
                    startAutoRefresh();
                } else {
                    stopAutoRefresh();
                }
            });

            // Initial load
            refreshLogs();
            startAutoRefresh();
        });

        function startAutoRefresh() {
            stopAutoRefresh();
            autoRefreshInterval = setInterval(refreshLogs, 5000);
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }

        async function refreshLogs() {
            try {
                const response = await fetch(`/api/logs/${currentLogType}?lines=500`);
                const data = await response.json();
                
                if (data.success) {
                    allLogs = data.logs;
                    filterLogs();
                    updateStats();
                } else {
                    showError(data.error || 'Failed to fetch logs');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            }
        }

        function filterLogs() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const levelFilter = document.getElementById('level-filter').value;

            let filtered = allLogs;

            // Apply search filter
            if (searchTerm) {
                filtered = filtered.filter(log => log.toLowerCase().includes(searchTerm));
            }

            // Apply level filter
            if (levelFilter !== 'all') {
                filtered = filtered.filter(log => {
                    const logLower = log.toLowerCase();
                    switch(levelFilter) {
                        case 'error':
                            return logLower.includes('error') || logLower.includes('fail') || logLower.includes('critical');
                        case 'warning':
                            return logLower.includes('warn') || logLower.includes('error') || logLower.includes('fail');
                        case 'info':
                            return !logLower.includes('debug');
                        default:
                            return true;
                    }
                });
            }

            displayLogs(filtered);
        }

        function displayLogs(logs) {
            const display = document.getElementById('log-display');
            
            if (logs.length === 0) {
                display.innerHTML = '<div class="no-logs">No logs found matching your filters</div>';
                return;
            }

            const html = logs.map(log => {
                const logClass = getLogClass(log);
                return `<div class="log-line ${logClass}">${escapeHtml(log)}</div>`;
            }).join('');

            display.innerHTML = html;
            
            // Auto-scroll to bottom if near bottom
            if (display.scrollHeight - display.scrollTop - display.clientHeight < 100) {
                display.scrollTop = display.scrollHeight;
            }
        }

        function getLogClass(log) {
            const logLower = log.toLowerCase();
            if (logLower.includes('error') || logLower.includes('fail') || logLower.includes('critical')) {
                return 'error';
            } else if (logLower.includes('warn')) {
                return 'warning';
            } else if (logLower.includes('info')) {
                return 'info';
            } else if (logLower.includes('debug')) {
                return 'debug';
            }
            return '';
        }

        function updateStats() {
            document.getElementById('total-lines').textContent = allLogs.length;
            
            const errors = allLogs.filter(log => 
                log.toLowerCase().includes('error') || 
                log.toLowerCase().includes('fail') || 
                log.toLowerCase().includes('critical')
            ).length;
            document.getElementById('error-count').textContent = errors;
            
            const warnings = allLogs.filter(log => 
                log.toLowerCase().includes('warn')
            ).length;
            document.getElementById('warning-count').textContent = warnings;
            
            const now = new Date();
            document.getElementById('last-update').textContent = 
                now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }

        function showError(message) {
            document.getElementById('log-display').innerHTML = 
                `<div class="no-logs" style="color: #fc8181;">‚ùå ${escapeHtml(message)}</div>`;
        }

        function clearDisplay() {
            allLogs = [];
            document.getElementById('log-display').innerHTML = 
                '<div class="no-logs">Display cleared. Click refresh to reload logs.</div>';
            updateStats();
        }

        function downloadLogs() {
            const blob = new Blob([allLogs.join('\n')], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `maestro-${currentLogType}-logs-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
